
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>nodestimation.processing.mneraw &#8212; NodesEstimation  documentation</title>
    <link rel="stylesheet" href="../../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/css/custom.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for nodestimation.processing.mneraw</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="o">*</span>

<span class="kn">import</span> <span class="nn">mne</span>
<span class="kn">import</span> <span class="nn">nibabel</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">nilearn.image</span> <span class="k">as</span> <span class="nn">image</span>
<span class="kn">from</span> <span class="nn">scipy.fftpack</span> <span class="kn">import</span> <span class="n">fftfreq</span><span class="p">,</span> <span class="n">irfft</span><span class="p">,</span> <span class="n">rfft</span>
<span class="kn">from</span> <span class="nn">nodestimation.processing.connectivity</span> <span class="kn">import</span> <span class="n">pearson_ts</span>
<span class="kn">from</span> <span class="nn">nodestimation.project</span> <span class="kn">import</span> <span class="n">read_or_write</span>
<span class="kn">from</span> <span class="nn">nodestimation</span> <span class="kn">import</span> <span class="n">Node</span>
<span class="kn">from</span> <span class="nn">nodestimation.project.annotations</span> <span class="kn">import</span> <span class="n">SubjectTree</span><span class="p">,</span> <span class="n">Features</span><span class="p">,</span> <span class="n">LabelsFeatures</span>


<div class="viewcode-block" id="notchfir"><a class="viewcode-back" href="../../../nodestimation.processing.html#nodestimation.processing.mneraw.notchfir">[docs]</a><span class="k">def</span> <span class="nf">notchfir</span><span class="p">(</span><span class="n">raw</span><span class="p">:</span> <span class="n">mne</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">Raw</span><span class="p">,</span> <span class="n">lfreq</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">nfreq</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">hfreq</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">mne</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">Raw</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;filters the given raw_ object from lfreq to nfreq and from nfreq to hfreq</span>

<span class="sd">        :param raw: raw_ to filter</span>
<span class="sd">        :type raw: |iraw|_</span>
<span class="sd">        :param lfreq: frequency for `low-pass filter &lt;https://en.wikipedia.org/wiki/Low-pass_filter&gt;`_, Hz</span>
<span class="sd">        :type lfreq: int</span>
<span class="sd">        :param nfreq: frequency for `band-stop filter &lt;https://en.wikipedia.org/wiki/Band-stop_filter&gt;`_, Hz</span>
<span class="sd">        :type nfreq: int</span>
<span class="sd">        :param hfreq: frequency for `high-pass filter &lt;https://en.wikipedia.org/wiki/High-pass_filter&gt;`_, Hz</span>
<span class="sd">        :type hfreq: int</span>
<span class="sd">        :return: filtered raw_</span>
<span class="sd">        :rtype: mne.io.raw_</span>

<span class="sd">        .. _mne.io.raw:</span>
<span class="sd">        .. _raw:</span>
<span class="sd">        .. _iraw: https://mne.tools/stable/generated/mne.io.Raw.html</span>

<span class="sd">        .. |iraw| replace:: *mne.io.raw*</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">meg_picks</span> <span class="o">=</span> <span class="n">mne</span><span class="o">.</span><span class="n">pick_types</span><span class="p">(</span><span class="n">raw</span><span class="o">.</span><span class="n">info</span><span class="p">,</span> <span class="n">meg</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">eeg</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">eog</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">raw_filtered</span> <span class="o">=</span> <span class="n">raw</span> \
        <span class="o">.</span><span class="n">load_data</span><span class="p">()</span> \
        <span class="o">.</span><span class="n">notch_filter</span><span class="p">(</span><span class="n">nfreq</span><span class="p">,</span> <span class="n">meg_picks</span><span class="p">)</span> \
        <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">l_freq</span><span class="o">=</span><span class="n">lfreq</span><span class="p">,</span> <span class="n">h_freq</span><span class="o">=</span><span class="n">hfreq</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">raw_filtered</span></div>


<div class="viewcode-block" id="artifacts_clean"><a class="viewcode-back" href="../../../nodestimation.processing.html#nodestimation.processing.mneraw.artifacts_clean">[docs]</a><span class="k">def</span> <span class="nf">artifacts_clean</span><span class="p">(</span><span class="n">raw</span><span class="p">:</span> <span class="n">mne</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">Raw</span><span class="p">,</span> <span class="n">n_components</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="kc">None</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">15</span><span class="p">,</span> <span class="n">method</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;correlation&#39;</span><span class="p">,</span> <span class="n">threshold</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="mf">3.0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">mne</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">Raw</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;makes `artifacts &lt;https://www.neuro.mcw.edu/meg/index.php/Artifacts_in_MEG_data&gt;`_ cleaning</span>
<span class="sd">        of raw_ object using `ICA &lt;https://en.wikipedia.org/wiki/Independent_component_analysis&gt;`_</span>

<span class="sd">        :param raw: raw_ to filter</span>
<span class="sd">        :type raw: |iraw|_</span>
<span class="sd">        :param n_components: number of principal components (from the pre-whitening PCA step) that are passed to the `ICA algorithm &lt;https://mne.tools/stable/generated/mne.preprocessing.ICA.html&gt;`_ during fitting, default 15</span>
<span class="sd">        :type n_components: |iint|_ *or* |ifloat|_ *or* |iNone|_ *, optional*</span>
<span class="sd">        :param method: The method used in the `algorithm &lt;https://mne.tools/stable/generated/mne.preprocessing.ICA.html?highlight=ica%20find_bads_ecg#mne.preprocessing.ICA.find_bads_ecg&gt;`_</span>
<span class="sd">            for detection `ecg &lt;https://en.wikipedia.org/wiki/Electrocardiography&gt;`_ or `eog &lt;https://en.wikipedia.org/wiki/Electrooculography&gt;`_</span>
<span class="sd">            `ICA &lt;https://en.wikipedia.org/wiki/Independent_component_analysis&gt;`_ components, can be either</span>
<span class="sd">            &quot;ctps&quot; (`cross-trial phase statistics &lt;https://www.researchgate.net/publication/23302818_Integration_of_Amplitude_and_Phase_Statistics_for_Complete_Artifact_Removal_in_Independent_Components_of_Neuromagnetic_Recordings&gt;`_) or</span>
<span class="sd">            `&quot;correlation&quot; &lt;https://en.wikipedia.org/wiki/Pearson_correlation_coefficient&gt;`_</span>
<span class="sd">        :type method: str, optional</span>
<span class="sd">        :param threshold: The value above which a feature is classified as outlier, can be computed automatically if given value is &quot;auto&quot;, default depends from method (look for</span>
<span class="sd">            `original function &lt;https://mne.tools/stable/generated/mne.preprocessing.ICA.html?highlight=ica%20find_bads_ecg#mne.preprocessing.ICA.find_bads_ecg&gt;`_)</span>
<span class="sd">        :type threshold: |ifloat|_ *or* |istr|_ *, optional*</span>
<span class="sd">        :return: cleaned raw_ object</span>
<span class="sd">        :rtype: mne.io.raw_</span>

<span class="sd">        .. _iNone: https://docs.python.org/3/library/constants.html#None</span>

<span class="sd">        .. |iNone| replace:: *None*</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">ica</span> <span class="o">=</span> <span class="n">mne</span><span class="o">.</span><span class="n">preprocessing</span><span class="o">.</span><span class="n">ICA</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="n">n_components</span><span class="p">)</span>
    <span class="n">ica</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">raw</span><span class="p">)</span>
    <span class="n">ica</span><span class="o">.</span><span class="n">exclude</span> <span class="o">=</span> <span class="n">ica</span><span class="o">.</span><span class="n">find_bads_eog</span><span class="p">(</span><span class="n">raw</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> \
                  <span class="n">ica</span><span class="o">.</span><span class="n">find_bads_ecg</span><span class="p">(</span><span class="n">raw</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="n">threshold</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">ica</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">raw</span><span class="p">)</span>

    <span class="k">del</span> <span class="n">ica</span>

    <span class="k">return</span> <span class="n">raw</span></div>


<div class="viewcode-block" id="read_original_raw"><a class="viewcode-back" href="../../../nodestimation.processing.html#nodestimation.processing.mneraw.read_original_raw">[docs]</a><span class="nd">@read_or_write</span><span class="p">(</span><span class="s1">&#39;raw&#39;</span><span class="p">,</span> <span class="n">search_target</span><span class="o">=</span><span class="s1">&#39;original&#39;</span><span class="p">,</span> <span class="n">write_file</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">read_original_raw</span><span class="p">(</span>
        <span class="n">path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>
        <span class="n">_subject_tree</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">SubjectTree</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">_conditions</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">_priority</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">mne</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">Raw</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;reads not processed raw_ data, uses :func:`nodestimation.project.read_or_write` decorator</span>

<span class="sd">        :param path: path to read</span>
<span class="sd">        :type path: str</span>
<span class="sd">        :param _subject_tree: representation of patient`s files structure, default None</span>
<span class="sd">        :type _subject_tree: *look for SubjectTree in* :mod:`nodestimation.project.annotations` *, optional*</span>
<span class="sd">        :param _conditions: output from :func:`nodestimation.project.conditions_unique_code`, default True</span>
<span class="sd">        :type _conditions: str, optional</span>
<span class="sd">        :param _priority: if several files are read, which one to choose, if None, read all of them, default None</span>
<span class="sd">        :type _priority: int, optional</span>
<span class="sd">        :return: read raw_ object</span>
<span class="sd">        :rtype: mne.io.raw_</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">mne</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_raw_fif</span><span class="p">(</span><span class="n">path</span><span class="p">)</span></div>


<div class="viewcode-block" id="first_processing"><a class="viewcode-back" href="../../../nodestimation.processing.html#nodestimation.processing.mneraw.first_processing">[docs]</a><span class="nd">@read_or_write</span><span class="p">(</span><span class="s1">&#39;raw&#39;</span><span class="p">,</span> <span class="n">search_target</span><span class="o">=</span><span class="s1">&#39;nepf&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">first_processing</span><span class="p">(</span>
        <span class="n">raw</span><span class="p">:</span> <span class="n">mne</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">Raw</span><span class="p">,</span> <span class="n">lfreq</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">nfreq</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">hfreq</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">rfreq</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">crop</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">reconstruct</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">meg</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">eeg</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">_subject_tree</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">SubjectTree</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">_conditions</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">_priority</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">mne</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">Raw</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;processes_ given raw_ object, uses :func:`nodestimation.project.read_or_write` decorator</span>

<span class="sd">        :param raw: raw_ to filter</span>
<span class="sd">        :type raw: |iraw|_</span>
<span class="sd">        :param lfreq: frequency for `low-pass filter &lt;https://en.wikipedia.org/wiki/Low-pass_filter&gt;`_, Hz</span>
<span class="sd">        :type lfreq: int</span>
<span class="sd">        :param nfreq: frequency for `band-stop filter &lt;https://en.wikipedia.org/wiki/Band-stop_filter&gt;`_, Hz</span>
<span class="sd">        :type nfreq: int</span>
<span class="sd">        :param hfreq: frequency for `high-pass filter &lt;https://en.wikipedia.org/wiki/High-pass_filter&gt;`_, Hz</span>
<span class="sd">        :type hfreq: int</span>
<span class="sd">        :param crop: end time of the raw data to use (in seconds), if None, does not crop, default None</span>
<span class="sd">        :type crop: |ifloat|_ *or* |ilist|_ *of* |ifloat|_ *or* |ituple|_ *of* |ifloat|_ *, optional*</span>
<span class="sd">        :param reconstruct: whether make `artifacts &lt;https://www.neuro.mcw.edu/meg/index.php/Artifacts_in_MEG_data&gt;`_ cleaning or not, default False</span>
<span class="sd">        :type reconstruct: bool, optional</span>
<span class="sd">        :param meg: whether pick meg channel or not, default True</span>
<span class="sd">        :type meg: bool, optional</span>
<span class="sd">        :param eeg: whether pick meg channel or not, default True</span>
<span class="sd">        :type eeg: bool, optional</span>
<span class="sd">        :param _subject_tree: representation of patient`s files structure, default None</span>
<span class="sd">        :type _subject_tree: *look for SubjectTree in* :mod:`nodestimation.project.annotations` *, optional*</span>
<span class="sd">        :param _conditions: output from :func:`nodestimation.project.conditions_unique_code`, defaults to True</span>
<span class="sd">        :type _conditions: str, optional</span>
<span class="sd">        :param _priority: if several files are read, which one to choose, if None, read all of them, default None</span>
<span class="sd">        :type _priority: int, optional</span>
<span class="sd">        :return: processed raw_ object</span>
<span class="sd">        :rtype: mne.io.raw_</span>

<span class="sd">        .. _processes:</span>
<span class="sd">        .. note:: Processing for raw_ data means</span>
<span class="sd">            `band-pass &lt;https://en.wikipedia.org/wiki/Band-pass_filter&gt;`_ and `band-stop &lt;https://en.wikipedia.org/wiki/Band-stop_filter&gt;`_ filtering,</span>
<span class="sd">            `cropping &lt;https://mne.tools/stable/generated/mne.io.Raw.html?highlight=raw%20crop#mne.io.Raw.crop&gt;`_ and `artifacts &lt;https://www.neuro.mcw.edu/meg/index.php/Artifacts_in_MEG_data&gt;`_ cleaning</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">out</span> <span class="o">=</span> <span class="n">raw</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">crop</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">crop</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">crop</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="n">out</span><span class="o">.</span><span class="n">crop</span><span class="p">(</span><span class="n">tmax</span><span class="o">=</span><span class="n">crop</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">crop</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> \
                <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">crop</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span> \
                <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">crop</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">out</span><span class="o">.</span><span class="n">crop</span><span class="p">(</span><span class="n">tmin</span><span class="o">=</span><span class="n">crop</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">tmax</span><span class="o">=</span><span class="n">crop</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Crop range is incorrect: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">crop</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">rfreq</span><span class="p">:</span>
        <span class="n">out</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">rfreq</span><span class="p">,</span> <span class="n">npad</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">)</span>

    <span class="n">out</span> <span class="o">=</span> <span class="n">notchfir</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">lfreq</span><span class="p">,</span> <span class="n">nfreq</span><span class="p">,</span> <span class="n">hfreq</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">reconstruct</span><span class="p">:</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">artifacts_clean</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>

    <span class="n">out</span><span class="o">.</span><span class="n">pick_types</span><span class="p">(</span><span class="n">meg</span><span class="o">=</span><span class="n">meg</span><span class="p">,</span> <span class="n">eeg</span><span class="o">=</span><span class="n">eeg</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">out</span></div>


<div class="viewcode-block" id="bem_computation"><a class="viewcode-back" href="../../../nodestimation.processing.html#nodestimation.processing.mneraw.bem_computation">[docs]</a><span class="nd">@read_or_write</span><span class="p">(</span><span class="s1">&#39;bem&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">bem_computation</span><span class="p">(</span>
        <span class="n">subject</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">subjects_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">conductivity</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">,</span>
        <span class="n">_subject_tree</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">SubjectTree</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">_conditions</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">_priority</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">mne</span><span class="o">.</span><span class="n">bem</span><span class="o">.</span><span class="n">ConductorModel</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Computes bem_ solution, uses :func:`nodestimation.project.read_or_write` decorator</span>

<span class="sd">        :param subject: patient`s ID</span>
<span class="sd">        :type subject: str</span>
<span class="sd">        :param subjects_dir: path to directory with patient`s files</span>
<span class="sd">        :type subjects_dir: str</span>
<span class="sd">        :param conductivity: the conductivities to use for each brain tissue shell. Single element for single-layer model or three elements for three-layer model</span>
<span class="sd">        :type conductivity: tuple</span>
<span class="sd">        :param _subject_tree: representation of patient`s files structure, default None</span>
<span class="sd">        :type _subject_tree: *look for SubjectTree in* :mod:`nodestimation.project.annotations` *, optional*</span>
<span class="sd">        :param _conditions: output from :func:`nodestimation.project.conditions_unique_code`, defaults to True</span>
<span class="sd">        :type _conditions: str, optional</span>
<span class="sd">        :param _priority: if several files are read, which one to choose, if None, read all of them, default None</span>
<span class="sd">        :type _priority: int, optional</span>
<span class="sd">        :return: bem_ solution</span>
<span class="sd">        :rtype: mne.bem.ConductorModel_</span>

<span class="sd">        .. _imne.bem.ConductorModel:</span>
<span class="sd">        .. _mne.bem.ConductorModel:</span>
<span class="sd">        .. _bem: https://mne.tools/stable/generated/mne.bem.ConductorModel.html?highlight=conductormodel#mne.bem.ConductorModel</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">mne</span><span class="o">.</span><span class="n">make_bem_model</span><span class="p">(</span><span class="n">subject</span><span class="o">=</span><span class="n">subject</span><span class="p">,</span> <span class="n">conductivity</span><span class="o">=</span><span class="n">conductivity</span><span class="p">,</span> <span class="n">subjects_dir</span><span class="o">=</span><span class="n">subjects_dir</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">mne</span><span class="o">.</span><span class="n">make_bem_solution</span><span class="p">(</span><span class="n">model</span><span class="p">)</span></div>


<div class="viewcode-block" id="src_computation"><a class="viewcode-back" href="../../../nodestimation.processing.html#nodestimation.processing.mneraw.src_computation">[docs]</a><span class="nd">@read_or_write</span><span class="p">(</span><span class="s1">&#39;src&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">src_computation</span><span class="p">(</span>
        <span class="n">subject</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">subjects_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">bem</span><span class="p">:</span> <span class="n">mne</span><span class="o">.</span><span class="n">bem</span><span class="o">.</span><span class="n">ConductorModel</span><span class="p">,</span>
        <span class="n">volume</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">_subject_tree</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">SubjectTree</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">_conditions</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">_priority</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">mne</span><span class="o">.</span><span class="n">SourceSpaces</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">mne</span><span class="o">.</span><span class="n">SourceSpaces</span><span class="p">]]:</span>
    <span class="sd">&quot;&quot;&quot;computes `source spaces`_ solution, uses :func:`nodestimation.project.read_or_write` decorator</span>

<span class="sd">        :param subject: patient`s ID</span>
<span class="sd">        :type subject: str</span>
<span class="sd">        :param subjects_dir: path to directory with patient`s files</span>
<span class="sd">        :type subjects_dir: str</span>
<span class="sd">        :param bem: bem_ solution</span>
<span class="sd">            to build SourceSpaces_</span>
<span class="sd">        :type bem: |imne.bem.ConductorModel|_</span>
<span class="sd">        :param volume: if True, computes `volume source spaces &lt;https://mne.tools/stable/generated/mne.setup_volume_source_space.html?highlight=setup_volume_source_space#mne.setup_volume_source_space&gt;`_,</span>
<span class="sd">            default False</span>
<span class="sd">        :type volume: bool, optional</span>
<span class="sd">        :param _subject_tree: representation of patient`s files structure, default None</span>
<span class="sd">        :type _subject_tree: *look for SubjectTree in* :mod:`nodestimation.project.annotations` *, optional*</span>
<span class="sd">        :param _conditions: output from :func:`nodestimation.project.conditions_unique_code`, defaults to True</span>
<span class="sd">        :type _conditions: str, optional</span>
<span class="sd">        :param _priority: if several files are read, which one to choose, if None, read all of them, default None</span>
<span class="sd">        :type _priority: int, optional</span>
<span class="sd">        :return: `source spaces`_ solution</span>
<span class="sd">        :rtype: mne.SourceSpaces_</span>

<span class="sd">        .. _imne.SourceSpaces:</span>
<span class="sd">        .. _mne.SourceSpaces:</span>
<span class="sd">        .. _SourceSpaces:</span>
<span class="sd">        .. _`source spaces`: https://mne.tools/stable/generated/mne.SourceSpaces.html#mne.SourceSpaces</span>

<span class="sd">        .. |imne.SourceSpaces| replace:: *mne.SourceSpaces*</span>
<span class="sd">        .. |imne.bem.ConductorModel| replace:: *mne.bem.ConductorModel*</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">src</span> <span class="o">=</span> <span class="n">mne</span><span class="o">.</span><span class="n">setup_source_space</span><span class="p">(</span><span class="n">subject</span><span class="p">,</span> <span class="n">spacing</span><span class="o">=</span><span class="s1">&#39;ico5&#39;</span><span class="p">,</span> <span class="n">add_dist</span><span class="o">=</span><span class="s1">&#39;patch&#39;</span><span class="p">,</span> <span class="n">subjects_dir</span><span class="o">=</span><span class="n">subjects_dir</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">volume</span><span class="p">:</span>
        <span class="n">labels_vol</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Left-Amygdala&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Left-Thalamus-Proper&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Left-Cerebellum-Cortex&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Brain-Stem&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Right-Amygdala&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Right-Thalamus-Proper&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Right-Cerebellum-Cortex&#39;</span><span class="p">]</span>
        <span class="n">fname_aseg</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">subjects_dir</span><span class="p">,</span> <span class="n">subject</span><span class="p">,</span> <span class="s1">&#39;mri&#39;</span><span class="p">,</span> <span class="s1">&#39;aseg.mgz&#39;</span><span class="p">)</span>
        <span class="n">vol_src</span> <span class="o">=</span> <span class="n">mne</span><span class="o">.</span><span class="n">setup_volume_source_space</span><span class="p">(</span>
            <span class="n">subject</span><span class="p">,</span> <span class="n">mri</span><span class="o">=</span><span class="n">fname_aseg</span><span class="p">,</span>
            <span class="n">pos</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span> <span class="n">bem</span><span class="o">=</span><span class="n">bem</span><span class="p">,</span>
            <span class="n">add_interpolator</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">volume_label</span><span class="o">=</span><span class="n">labels_vol</span><span class="p">,</span>
            <span class="n">subjects_dir</span><span class="o">=</span><span class="n">subjects_dir</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">src</span> <span class="o">+</span> <span class="n">vol_src</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">src</span></div>


<div class="viewcode-block" id="read_original_trans"><a class="viewcode-back" href="../../../nodestimation.processing.html#nodestimation.processing.mneraw.read_original_trans">[docs]</a><span class="nd">@read_or_write</span><span class="p">(</span><span class="s1">&#39;trans&#39;</span><span class="p">,</span> <span class="n">search_target</span><span class="o">=</span><span class="s1">&#39;original&#39;</span><span class="p">,</span> <span class="n">write_file</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">read_original_trans</span><span class="p">(</span>
        <span class="n">path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>
        <span class="n">_subject_tree</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">SubjectTree</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">_conditions</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">_priority</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">dict</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]]:</span>
    <span class="sd">&quot;&quot;&quot;reads given `transformation matrix`_, uses :func:`nodestimation.project.read_or_write` decorator</span>

<span class="sd">        :param path: path to read</span>
<span class="sd">        :type path: str</span>
<span class="sd">        :param _subject_tree: representation of patient`s files structure, default None</span>
<span class="sd">        :type _subject_tree: *look for SubjectTree in* :mod:`nodestimation.project.annotations` *, optional*</span>
<span class="sd">        :param _conditions: output from :func:`nodestimation.project.conditions_unique_code`, default True</span>
<span class="sd">        :type _conditions: str, optional</span>
<span class="sd">        :param _priority: if several files are read, which one to choose, if None, read all of them, default None</span>
<span class="sd">        :type _priority: int, optional</span>
<span class="sd">        :return: read `transformation matrix`_</span>
<span class="sd">        :rtype: mne.transforms.Transform_</span>

<span class="sd">        .. _imne.transforms.Transform:</span>
<span class="sd">        .. _mne.transforms.Transform:</span>
<span class="sd">        .. _`transformation matrix`: https://mne.tools/stable/generated/mne.transforms.Transform.html#mne.transforms.Transform</span>

<span class="sd">        .. |imne.transforms.Transform| replace:: *mne.transforms.Transform*</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="n">mne</span><span class="o">.</span><span class="n">read_trans</span><span class="p">(</span><span class="n">path</span><span class="p">)</span></div>


<div class="viewcode-block" id="forward_computation"><a class="viewcode-back" href="../../../nodestimation.processing.html#nodestimation.processing.mneraw.forward_computation">[docs]</a><span class="nd">@read_or_write</span><span class="p">(</span><span class="s1">&#39;fwd&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">forward_computation</span><span class="p">(</span>
        <span class="n">info</span><span class="p">:</span> <span class="n">mne</span><span class="o">.</span><span class="n">Info</span><span class="p">,</span>
        <span class="n">trans</span><span class="p">:</span> <span class="n">mne</span><span class="o">.</span><span class="n">Transform</span><span class="p">,</span>
        <span class="n">src</span><span class="p">:</span> <span class="n">mne</span><span class="o">.</span><span class="n">SourceSpaces</span><span class="p">,</span>
        <span class="n">bem</span><span class="p">:</span> <span class="n">mne</span><span class="o">.</span><span class="n">bem</span><span class="o">.</span><span class="n">ConductorModel</span><span class="p">,</span>
        <span class="n">_subject_tree</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">SubjectTree</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">_conditions</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">_priority</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">mne</span><span class="o">.</span><span class="n">forward</span><span class="o">.</span><span class="n">Forward</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;computes `forward solution`_, uses :func:`nodestimation.project.read_or_write` decorator</span>

<span class="sd">        :param info: information about raw data</span>
<span class="sd">        :type info: |imne.Info|_</span>
<span class="sd">        :param trans: `transformation matrix`_</span>
<span class="sd">        :type trans: |imne.transforms.Transform|_</span>
<span class="sd">        :param src: `source spaces`_</span>
<span class="sd">        :type src: |imne.SourceSpaces|_</span>
<span class="sd">        :param bem: bem_ solution</span>
<span class="sd">        :type bem: mne.bem.ConductorModel_</span>
<span class="sd">        :param _subject_tree: representation of patient`s files structure, default None</span>
<span class="sd">        :type _subject_tree: *look for SubjectTree in* :mod:`nodestimation.project.annotations` *, optional*</span>
<span class="sd">        :param _conditions: output from :func:`nodestimation.project.conditions_unique_code`, defaults to True</span>
<span class="sd">        :type _conditions: str, optional</span>
<span class="sd">        :param _priority: if several files are read, which one to choose, if None, read all of them, default None</span>
<span class="sd">        :type _priority: int, optional</span>
<span class="sd">        :return: `forward solution`_</span>
<span class="sd">        :rtype: mne.Forward_</span>

<span class="sd">        .. _imne.Forward:</span>
<span class="sd">        .. _mne.Forward:</span>
<span class="sd">        .. _`forward solution`: https://mne.tools/stable/generated/mne.Forward.html?highlight=forward#mne.Forward</span>
<span class="sd">        .. _imne.Info: https://mne.tools/stable/generated/mne.Info.html?highlight=info#mne.Info</span>

<span class="sd">        .. |imne.Info| replace:: *mne.Info*</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="n">mne</span><span class="o">.</span><span class="n">make_forward_solution</span><span class="p">(</span><span class="n">info</span><span class="p">,</span> <span class="n">trans</span><span class="o">=</span><span class="n">trans</span><span class="p">,</span> <span class="n">src</span><span class="o">=</span><span class="n">src</span><span class="p">,</span> <span class="n">bem</span><span class="o">=</span><span class="n">bem</span><span class="p">,</span> <span class="n">meg</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">eeg</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                     <span class="n">mindist</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>


<div class="viewcode-block" id="events_computation"><a class="viewcode-back" href="../../../nodestimation.processing.html#nodestimation.processing.mneraw.events_computation">[docs]</a><span class="nd">@read_or_write</span><span class="p">(</span><span class="s1">&#39;eve&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">events_computation</span><span class="p">(</span>
        <span class="n">raw</span><span class="p">:</span> <span class="n">mne</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">Raw</span><span class="p">,</span>
        <span class="n">time_points</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="nb">range</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span>
        <span class="n">ids</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
        <span class="n">_subject_tree</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">SubjectTree</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">_conditions</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">_priority</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;creates events for given raw_ object, uses :func:`nodestimation.project.read_or_write` decorator</span>

<span class="sd">        :param raw: raw_ to filter</span>
<span class="sd">        :type raw: |iraw|_</span>
<span class="sd">        :param time_points: times for events start</span>
<span class="sd">        :type time_points: |ilist|_ *of* |iint|_ *or* |inp.ndarray|_</span>
<span class="sd">        :param ids: number for events identification</span>
<span class="sd">        :type ids: |ilist|_ *of* |iint|_</span>
<span class="sd">        :param _subject_tree: representation of patient`s files structure, default None</span>
<span class="sd">        :type _subject_tree: *look for SubjectTree in* :mod:`nodestimation.project.annotations` *, optional*</span>
<span class="sd">        :param _conditions: output from :func:`nodestimation.project.conditions_unique_code`, defaults to True</span>
<span class="sd">        :type _conditions: str, optional</span>
<span class="sd">        :param _priority: if several files are read, which one to choose, if None, read all of them, default None</span>
<span class="sd">        :type _priority: int, optional</span>
<span class="sd">        :return: array of events</span>
<span class="sd">        :rtype: np.ndarray_</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span>
        <span class="n">raw</span><span class="o">.</span><span class="n">first_samp</span> <span class="o">+</span> <span class="n">raw</span><span class="o">.</span><span class="n">time_as_index</span><span class="p">(</span><span class="n">time_point</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
        <span class="mi">0</span><span class="p">,</span>
        <span class="n">event_id</span>

    <span class="p">]</span> <span class="k">for</span> <span class="n">time_point</span><span class="p">,</span> <span class="n">event_id</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">time_points</span><span class="p">,</span> <span class="n">ids</span><span class="p">)])</span></div>


<div class="viewcode-block" id="epochs_computation"><a class="viewcode-back" href="../../../nodestimation.processing.html#nodestimation.processing.mneraw.epochs_computation">[docs]</a><span class="nd">@read_or_write</span><span class="p">(</span><span class="s1">&#39;epo&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">epochs_computation</span><span class="p">(</span>
        <span class="n">raw</span><span class="p">:</span> <span class="n">mne</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">Raw</span><span class="p">,</span>
        <span class="n">events</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="n">tmin</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">tmax</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">_subject_tree</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">SubjectTree</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">_conditions</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">_priority</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">mne</span><span class="o">.</span><span class="n">Epochs</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;creates epochs_ from given raw_ object, uses :func:`nodestimation.project.read_or_write` decorator</span>

<span class="sd">            :param raw: raw_ to filter</span>
<span class="sd">            :type raw: |iraw|_</span>
<span class="sd">            :param events: events to detect epochs</span>
<span class="sd">            :type events: |inp.ndarray|_</span>
<span class="sd">            :param tmin: start time to an epoch_</span>
<span class="sd">            :type tmin: int</span>
<span class="sd">            :param tmax: end time to an epoch_</span>
<span class="sd">            :type tmax: int</span>
<span class="sd">            :param _subject_tree: representation of patient`s files structure, default None</span>
<span class="sd">            :type _subject_tree: *look for SubjectTree in* :mod:`nodestimation.project.annotations` *, optional*</span>
<span class="sd">            :param _conditions: output from :func:`nodestimation.project.conditions_unique_code`, defaults to True</span>
<span class="sd">            :type _conditions: str, optional</span>
<span class="sd">            :param _priority: if several files are read, which one to choose, if None, read all of them, default None</span>
<span class="sd">            :type _priority: int, optional</span>
<span class="sd">            :return: array of events</span>
<span class="sd">            :rtype: np.ndarray_</span>

<span class="sd">            .. _epoched:</span>
<span class="sd">            .. _imne.Epochs:</span>
<span class="sd">            .. _mne.Epochs:</span>
<span class="sd">            .. _epoch:</span>
<span class="sd">            .. _epochs: https://mne.tools/stable/python_reference.html?highlight=epoch#module-mne.epochs</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="n">mne</span><span class="o">.</span><span class="n">Epochs</span><span class="p">(</span><span class="n">raw</span><span class="p">,</span> <span class="n">events</span><span class="p">,</span> <span class="n">tmin</span><span class="o">=</span><span class="n">tmin</span><span class="p">,</span> <span class="n">tmax</span><span class="o">=</span><span class="n">tmax</span><span class="p">)</span></div>


<div class="viewcode-block" id="noise_covariance_computation"><a class="viewcode-back" href="../../../nodestimation.processing.html#nodestimation.processing.mneraw.noise_covariance_computation">[docs]</a><span class="nd">@read_or_write</span><span class="p">(</span><span class="s1">&#39;cov&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">noise_covariance_computation</span><span class="p">(</span>
        <span class="n">epochs</span><span class="p">:</span> <span class="n">mne</span><span class="o">.</span><span class="n">Epochs</span><span class="p">,</span>
        <span class="n">tmin</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">tmax</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">_subject_tree</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">SubjectTree</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">_conditions</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">_priority</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">mne</span><span class="o">.</span><span class="n">Covariance</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;computes `covariance matrix`_, uses :func:`nodestimation.project.read_or_write` decorator</span>

<span class="sd">        :param epochs: epochs to compute covariance</span>
<span class="sd">        :type epochs: |imne.Epochs|_</span>
<span class="sd">        :param tmin: start time to a `covariance matrix`_</span>
<span class="sd">        :type tmin: int</span>
<span class="sd">        :param tmax: end time to a `covariance matrix`_</span>
<span class="sd">        :type tmax: int</span>
<span class="sd">        :param _subject_tree: representation of patient`s files structure, default None</span>
<span class="sd">        :type _subject_tree: *look for SubjectTree in* :mod:`nodestimation.project.annotations` *, optional*</span>
<span class="sd">        :param _conditions: output from :func:`nodestimation.project.conditions_unique_code`, defaults to True</span>
<span class="sd">        :type _conditions: str, optional</span>
<span class="sd">        :param _priority: if several files are read, which one to choose, if None, read all of them, default None</span>
<span class="sd">        :type _priority: int, optional</span>
<span class="sd">        :return: `covariance matrix`_</span>
<span class="sd">        :rtype: mne.Covariance_</span>

<span class="sd">        .. _imne.Covariance:</span>
<span class="sd">        .. _mne.Covariance:</span>
<span class="sd">        .. _`covariance matrix`:</span>
<span class="sd">        .. _covariance: https://mne.tools/stable/generated/mne.Covariance.html#mne.Covariance</span>

<span class="sd">        .. |imne.Epochs| replace:: *mne.Epochs*</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="n">mne</span><span class="o">.</span><span class="n">compute_covariance</span><span class="p">(</span><span class="n">epochs</span><span class="p">,</span> <span class="n">tmin</span><span class="o">=</span><span class="n">tmin</span><span class="p">,</span> <span class="n">tmax</span><span class="o">=</span><span class="n">tmax</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;empirical&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="evokeds_computation"><a class="viewcode-back" href="../../../nodestimation.processing.html#nodestimation.processing.mneraw.evokeds_computation">[docs]</a><span class="nd">@read_or_write</span><span class="p">(</span><span class="s1">&#39;ave&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">evokeds_computation</span><span class="p">(</span>
        <span class="n">epochs</span><span class="p">:</span> <span class="n">mne</span><span class="o">.</span><span class="n">Epochs</span><span class="p">,</span>
        <span class="n">_subject_tree</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">SubjectTree</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">_conditions</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">_priority</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">mne</span><span class="o">.</span><span class="n">Evoked</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;computes evokeds_, uses :func:`nodestimation.project.read_or_write` decorator</span>

<span class="sd">        :param epochs: epochs to compute covariance</span>
<span class="sd">        :type epochs: |imne.Epochs|_</span>
<span class="sd">        :param _subject_tree: representation of patient`s files structure, default None</span>
<span class="sd">        :type _subject_tree: *look for SubjectTree in* :mod:`nodestimation.project.annotations` *, optional*</span>
<span class="sd">        :param _conditions: output from :func:`nodestimation.project.conditions_unique_code`, defaults to True</span>
<span class="sd">        :type _conditions: str, optional</span>
<span class="sd">        :param _priority: if several files are read, which one to choose, if None, read all of them, default None</span>
<span class="sd">        :type _priority: int, optional</span>
<span class="sd">        :return: evoked_ data</span>
<span class="sd">        :rtype: mne.Evoked_</span>

<span class="sd">        .. _mne.Evoked:</span>
<span class="sd">        .. _evoked:</span>
<span class="sd">        .. _evokeds: https://mne.tools/stable/generated/mne.Evoked.html#mne.Evoked</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="n">epochs</span><span class="o">.</span><span class="n">average</span><span class="p">()</span></div>


<div class="viewcode-block" id="inverse_computation"><a class="viewcode-back" href="../../../nodestimation.processing.html#nodestimation.processing.mneraw.inverse_computation">[docs]</a><span class="nd">@read_or_write</span><span class="p">(</span><span class="s1">&#39;inv&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">inverse_computation</span><span class="p">(</span>
        <span class="n">info</span><span class="p">:</span> <span class="n">mne</span><span class="o">.</span><span class="n">Info</span><span class="p">,</span>
        <span class="n">fwd</span><span class="p">:</span> <span class="n">mne</span><span class="o">.</span><span class="n">Forward</span><span class="p">,</span>
        <span class="n">cov</span><span class="p">:</span> <span class="n">mne</span><span class="o">.</span><span class="n">Covariance</span><span class="p">,</span>
        <span class="n">_subject_tree</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">SubjectTree</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">_conditions</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">_priority</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">mne</span><span class="o">.</span><span class="n">minimum_norm</span><span class="o">.</span><span class="n">inverse</span><span class="o">.</span><span class="n">InverseOperator</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;computes `inverse solution`_, uses :func:`nodestimation.project.read_or_write` decorator</span>

<span class="sd">        :param info: information about raw data</span>
<span class="sd">        :type info: |imne.Info|_</span>
<span class="sd">        :param fwd: `forward solution`_</span>
<span class="sd">        :type fwd: |imne.Forward|_</span>
<span class="sd">        :param cov: `covariance matrix`_</span>
<span class="sd">        :type cov: |imne.Covariance|_</span>
<span class="sd">        :param _subject_tree: representation of patient`s files structure, default None</span>
<span class="sd">        :type _subject_tree: *look for SubjectTree in* :mod:`nodestimation.project.annotations` *, optional*</span>
<span class="sd">        :param _conditions: output from :func:`nodestimation.project.conditions_unique_code`, defaults to True</span>
<span class="sd">        :type _conditions: str, optional</span>
<span class="sd">        :param _priority: if several files are read, which one to choose, if None, read all of them, default None</span>
<span class="sd">        :type _priority: int, optional</span>
<span class="sd">        :return: `source spaces`_ solution</span>
<span class="sd">        :rtype: mne.minimum_norm.InverseOperator_</span>

<span class="sd">        .. |imne.Covariance| replace:: *mne.Covariance*</span>

<span class="sd">        .. |imne.Forward| replace:: *mne.Forward*</span>

<span class="sd">        .. _imne.minimum_norm.InverseOperator:</span>
<span class="sd">        .. _mne.minimum_norm.InverseOperator:</span>
<span class="sd">        .. _`inverse solution`: https://mne.tools/stable/generated/mne.minimum_norm.InverseOperator.html#mne.minimum_norm.InverseOperator</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">mne</span><span class="o">.</span><span class="n">minimum_norm</span><span class="o">.</span><span class="n">make_inverse_operator</span><span class="p">(</span><span class="n">info</span><span class="p">,</span> <span class="n">fwd</span><span class="p">,</span> <span class="n">cov</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fixed</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>


<div class="viewcode-block" id="source_estimation"><a class="viewcode-back" href="../../../nodestimation.processing.html#nodestimation.processing.mneraw.source_estimation">[docs]</a><span class="nd">@read_or_write</span><span class="p">(</span><span class="s1">&#39;stc&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">source_estimation</span><span class="p">(</span>
        <span class="n">epochs</span><span class="p">:</span> <span class="n">mne</span><span class="o">.</span><span class="n">Epochs</span><span class="p">,</span>
        <span class="n">inv</span><span class="p">:</span> <span class="n">mne</span><span class="o">.</span><span class="n">minimum_norm</span><span class="o">.</span><span class="n">inverse</span><span class="o">.</span><span class="n">InverseOperator</span><span class="p">,</span>
        <span class="n">lambda2</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span>
        <span class="n">method</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">_subject_tree</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">SubjectTree</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">_conditions</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">_priority</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">mne</span><span class="o">.</span><span class="n">SourceEstimate</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;computes `source estimation`_, uses :func:`nodestimation.project.read_or_write` decorator</span>

<span class="sd">        :param epochs: epochs to compute covariance</span>
<span class="sd">        :type epochs: |imne.Epochs|_</span>
<span class="sd">        :param inv: `inverse solution`_</span>
<span class="sd">        :type inv: |imne.minimum_norm.InverseOperator|_</span>
<span class="sd">        :param lambda2: regularization parameter</span>
<span class="sd">        :type lambda2: |iint|_ *or* |ifloat|_</span>
<span class="sd">        :param method: `method &lt;nodestimation.html#list-of-mne-solutions&gt;`_ to compute `inverse solution`_</span>
<span class="sd">        :type method: str</span>
<span class="sd">        :param _subject_tree: representation of patient`s files structure, default None</span>
<span class="sd">        :type _subject_tree: *look for SubjectTree in* :mod:`nodestimation.project.annotations` *, optional*</span>
<span class="sd">        :param _conditions: output from :func:`nodestimation.project.conditions_unique_code`, defaults to True</span>
<span class="sd">        :type _conditions: str, optional</span>
<span class="sd">        :param _priority: if several files are read, which one to choose, if None, read all of them, default None</span>
<span class="sd">        :type _priority: int, optional</span>
<span class="sd">        :return: `source estimation`_ for epoched_ data</span>
<span class="sd">        :rtype: mne.SourceEstimate_</span>

<span class="sd">        .. _mne.SourceEstimate:</span>
<span class="sd">        .. _`source estimation`: https://mne.tools/stable/generated/mne.SourceEstimate.html</span>

<span class="sd">        .. |imne.minimum_norm.InverseOperator| replace:: *mne.minimum_norm.InverseOperator*</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">mne</span><span class="o">.</span><span class="n">minimum_norm</span><span class="o">.</span><span class="n">apply_inverse_epochs</span><span class="p">(</span>
        <span class="n">epochs</span><span class="p">,</span>
        <span class="n">inv</span><span class="p">,</span>
        <span class="n">lambda2</span><span class="p">,</span>
        <span class="n">method</span><span class="p">,</span>
        <span class="n">pick_ori</span><span class="o">=</span><span class="kc">None</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="coordinates_computation"><a class="viewcode-back" href="../../../nodestimation.processing.html#nodestimation.processing.mneraw.coordinates_computation">[docs]</a><span class="nd">@read_or_write</span><span class="p">(</span><span class="s1">&#39;coords&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">coordinates_computation</span><span class="p">(</span>
        <span class="n">subject</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">subjects_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">labels</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">mne</span><span class="o">.</span><span class="n">Label</span><span class="p">],</span>
        <span class="n">_subject_tree</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">SubjectTree</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">_conditions</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">_priority</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;computes central coordinates for given brain regions, uses :func:`nodestimation.project.read_or_write` decorator</span>

<span class="sd">        :param subject: patient`s ID</span>
<span class="sd">        :type subject: str</span>
<span class="sd">        :param subjects_dir: path to directory with patient`s files</span>
<span class="sd">        :type subjects_dir: str</span>
<span class="sd">        :param labels: brain regions representation</span>
<span class="sd">        :type labels: |ilist|_ *of* |imne.Label|_</span>
<span class="sd">        :param _subject_tree: representation of patient`s files structure, default None</span>
<span class="sd">        :type _subject_tree: *look for SubjectTree in* :mod:`nodestimation.project.annotations` *, optional*</span>
<span class="sd">        :param _conditions: output from :func:`nodestimation.project.conditions_unique_code`, defaults to True</span>
<span class="sd">        :type _conditions: str, optional</span>
<span class="sd">        :param _priority: if several files are read, which one to choose, if None, read all of them, default None</span>
<span class="sd">        :type _priority: int, optional</span>
<span class="sd">        :return: central coordinates relatively to brain region names</span>
<span class="sd">        :rtype: |idict|_ *of* |istr|_ *to* |inp.ndarray|_</span>

<span class="sd">        .. _labels:</span>
<span class="sd">        .. _imne.Label:</span>
<span class="sd">        .. _mne.Label: https://mne.tools/stable/generated/mne.Label.html?highlight=label#mne.Label</span>

<span class="sd">        .. |imne.Label| replace:: *mne.Label*</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">vertexes</span> <span class="o">=</span> <span class="p">[</span><span class="n">mne</span><span class="o">.</span><span class="n">vertex_to_mni</span><span class="p">(</span>
        <span class="n">label</span><span class="o">.</span><span class="n">vertices</span><span class="p">,</span>
        <span class="n">hemis</span><span class="o">=</span><span class="mi">0</span> <span class="k">if</span> <span class="n">label</span><span class="o">.</span><span class="n">hemi</span> <span class="o">==</span> <span class="s1">&#39;lh&#39;</span> <span class="k">else</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">subject</span><span class="o">=</span><span class="n">subject</span><span class="p">,</span> <span class="n">subjects_dir</span><span class="o">=</span><span class="n">subjects_dir</span>
    <span class="p">)</span> <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">labels</span><span class="p">]</span>
    <span class="k">return</span> <span class="p">{</span><span class="n">label</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">vertex</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">label</span><span class="p">,</span> <span class="n">vertex</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">vertexes</span><span class="p">)}</span></div>


<div class="viewcode-block" id="read_original_resec"><a class="viewcode-back" href="../../../nodestimation.processing.html#nodestimation.processing.mneraw.read_original_resec">[docs]</a><span class="nd">@read_or_write</span><span class="p">(</span><span class="s1">&#39;resec&#39;</span><span class="p">,</span> <span class="n">search_target</span><span class="o">=</span><span class="s1">&#39;original&#39;</span><span class="p">,</span> <span class="n">write_file</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">read_original_resec</span><span class="p">(</span>
        <span class="n">path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>
        <span class="n">_subject_tree</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">SubjectTree</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">_conditions</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">_priority</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;reads given `resection map`_, uses :func:`nodestimation.project.read_or_write` decorator</span>

<span class="sd">        :param path: path to read</span>
<span class="sd">        :type path: str</span>
<span class="sd">        :param _subject_tree: representation of patient`s files structure, default None</span>
<span class="sd">        :type _subject_tree: *look for SubjectTree in* :mod:`nodestimation.project.annotations` *, optional*</span>
<span class="sd">        :param _conditions: output from :func:`nodestimation.project.conditions_unique_code`, default True</span>
<span class="sd">        :type _conditions: str, optional</span>
<span class="sd">        :param _priority: if several files are read, which one to choose, if None, read all of them, default None</span>
<span class="sd">        :type _priority: int, optional</span>
<span class="sd">        :return: read `resection map`_</span>
<span class="sd">        :rtype: Any</span>

<span class="sd">        .. _`resection map`: https://nipy.org/nibabel/reference/nibabel.loadsave.html#module-nibabel.loadsave</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="n">nibabel</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">path</span><span class="p">)</span></div>


<div class="viewcode-block" id="resection_area_computation"><a class="viewcode-back" href="../../../nodestimation.processing.html#nodestimation.processing.mneraw.resection_area_computation">[docs]</a><span class="nd">@read_or_write</span><span class="p">(</span><span class="s1">&#39;resec_mni&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">resection_area_computation</span><span class="p">(</span><span class="n">img</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">_subject_tree</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">_conditions</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">_priority</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;turns given `resection map`_ into mni_ coordinate system, uses :func:`nodestimation.project.read_or_write` decorator</span>

<span class="sd">        :param img: `resection map`_</span>
<span class="sd">        :type img: Any</span>
<span class="sd">        :param _subject_tree: representation of patient`s files structure, default None</span>
<span class="sd">        :type _subject_tree: *look for SubjectTree in* :mod:`nodestimation.project.annotations` *, optional*</span>
<span class="sd">        :param _conditions: output from :func:`nodestimation.project.conditions_unique_code`, default True</span>
<span class="sd">        :type _conditions: str, optional</span>
<span class="sd">        :param _priority: if several files are read, which one to choose, if None, read all of them, default None</span>
<span class="sd">        :type _priority: int, optional</span>
<span class="sd">        :return: resection area</span>
<span class="sd">        :rtype: np.ndarray_</span>

<span class="sd">        .. _mni: https://brainmap.org/training/BrettTransform.html</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">res</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">get_data</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
    <span class="n">img_coordinates</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]):</span>
                <span class="k">if</span> <span class="n">res</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">img_coordinates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]))</span>
    <span class="n">img_coordinates</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">img_coordinates</span><span class="p">)</span>
    <span class="n">mni_coordinates</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">coordinate</span> <span class="ow">in</span> <span class="n">img_coordinates</span><span class="p">:</span>
        <span class="n">mni_coordinates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                <span class="n">image</span><span class="o">.</span><span class="n">coord_transform</span><span class="p">(</span>
                    <span class="n">coordinate</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                    <span class="n">coordinate</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                    <span class="n">coordinate</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                    <span class="n">img</span><span class="o">.</span><span class="n">affine</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mni_coordinates</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mni_coordinates</span><span class="p">)</span></div>


<div class="viewcode-block" id="read_original_resec_txt"><a class="viewcode-back" href="../../../nodestimation.processing.html#nodestimation.processing.mneraw.read_original_resec_txt">[docs]</a><span class="nd">@read_or_write</span><span class="p">(</span><span class="s1">&#39;resec_txt&#39;</span><span class="p">,</span> <span class="n">search_target</span><span class="o">=</span><span class="s1">&#39;original&#39;</span><span class="p">,</span> <span class="n">write_file</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">read_original_resec_txt</span><span class="p">(</span>
        <span class="n">path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
        <span class="n">_subject_tree</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">SubjectTree</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">_conditions</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">_priority</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;reads given resection area text description, uses :func:`nodestimation.project.read_or_write` decorator</span>

<span class="sd">        :param path: path to read</span>
<span class="sd">        :type path: str</span>
<span class="sd">        :param _subject_tree: representation of patient`s files structure, default None</span>
<span class="sd">        :type _subject_tree: *look for SubjectTree in* :mod:`nodestimation.project.annotations` *, optional*</span>
<span class="sd">        :param _conditions: output from :func:`nodestimation.project.conditions_unique_code`, default True</span>
<span class="sd">        :type _conditions: str, optional</span>
<span class="sd">        :param _priority: if several files are read, which one to choose, if None, read all of them, default None</span>
<span class="sd">        :type _priority: int, optional</span>
<span class="sd">        :return: read resection area text description</span>
<span class="sd">        :rtype: str</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span></div>


<div class="viewcode-block" id="features_computation"><a class="viewcode-back" href="../../../nodestimation.processing.html#nodestimation.processing.mneraw.features_computation">[docs]</a><span class="nd">@read_or_write</span><span class="p">(</span><span class="s1">&#39;feat&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">features_computation</span><span class="p">(</span>
        <span class="n">epochs</span><span class="p">:</span> <span class="n">mne</span><span class="o">.</span><span class="n">Epochs</span><span class="p">,</span>
        <span class="n">inv</span><span class="p">:</span> <span class="n">mne</span><span class="o">.</span><span class="n">minimum_norm</span><span class="o">.</span><span class="n">inverse</span><span class="o">.</span><span class="n">InverseOperator</span><span class="p">,</span>
        <span class="n">lambda2</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">bandwidth</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span>
        <span class="n">labels</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">mne</span><span class="o">.</span><span class="n">Label</span><span class="p">],</span>
        <span class="n">label_ts</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span>
        <span class="n">sfreq</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span>
        <span class="n">freq_bands</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">tuple</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">tuple</span><span class="p">]],</span>
        <span class="n">methods</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
        <span class="n">se_method</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">_subject_tree</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">SubjectTree</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">_conditions</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">_priority</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Features</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;computes `features &lt;nodestimation.html#list-of-metrics&gt;`_, uses :func:`nodestimation.project.read_or_write` decorator</span>

<span class="sd">        :param epochs: epochs to compute covariance</span>
<span class="sd">        :type epochs: |imne.Epochs|_</span>
<span class="sd">        :param inv: `inverse solution`_</span>
<span class="sd">        :type inv: |imne.minimum_norm.InverseOperator|_</span>
<span class="sd">        :param lambda2: regularization parameter</span>
<span class="sd">        :type lambda2: |iint|_ *or* |ifloat|_</span>
<span class="sd">        :param bandwidth: the bandwidth of the multi taper windowing function in Hz</span>
<span class="sd">        :type bandwidth: |iint|_ *or* |ifloat|_</span>
<span class="sd">        :param labels: brain regions representation</span>
<span class="sd">        :type labels: |ilist|_ *of* |imne.Label|_</span>
<span class="sd">        :param label_ts: time courses for labels_</span>
<span class="sd">        :type label_ts: |inp.ndarray|_</span>
<span class="sd">        :param sfreq: sample frequency for raw_ object</span>
<span class="sd">        :type sfreq: |iint|_ *or* |ifloat|_</span>
<span class="sd">        :param freq_bands: frequency bands in which to compute connectivity</span>
<span class="sd">        :type freq_bands: |ituple|_ *or* |ilist|_ *of* |ituple|_</span>
<span class="sd">        :param methods: `metrics &lt;nodestimation.html#list-of-metrics&gt;`_ to compute</span>
<span class="sd">        :type methods: |istr|_ *or* |ilist|_ *of* |istr|_</span>
<span class="sd">        :param se_method: metric to compute `mne solution &lt;nodestimation.html#list-of-mne-solutions&gt;`_</span>
<span class="sd">        :type se_method: str</span>
<span class="sd">        :param _subject_tree: representation of patient`s files structure, default None</span>
<span class="sd">        :type _subject_tree: *look for SubjectTree in* :mod:`nodestimation.project.annotations` *, optional*</span>
<span class="sd">        :param _conditions: output from :func:`nodestimation.project.conditions_unique_code`, defaults to True</span>
<span class="sd">        :type _conditions: str, optional</span>
<span class="sd">        :param _priority: if several files are read, which one to choose, if None, read all of them, default None</span>
<span class="sd">        :type _priority: int, optional</span>
<span class="sd">        :return: computed features</span>
<span class="sd">        :rtype: look for Features in :mod:`nodestimation.project.annotations`</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">methods</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="n">methods</span> <span class="o">=</span> <span class="p">[</span><span class="n">methods</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">spectral_connectivity_computation</span><span class="p">(</span><span class="nb">input</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
        <span class="n">label_ts</span><span class="p">,</span> <span class="n">sfreq</span><span class="p">,</span> <span class="n">fmin</span><span class="p">,</span> <span class="n">fmax</span><span class="p">,</span> <span class="n">method</span> <span class="o">=</span> <span class="nb">input</span>

        <span class="k">return</span> <span class="n">mne</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">spectral_connectivity</span><span class="p">(</span>
            <span class="n">label_ts</span><span class="p">,</span>
            <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span>
            <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;multitaper&#39;</span><span class="p">,</span>
            <span class="n">sfreq</span><span class="o">=</span><span class="n">sfreq</span><span class="p">,</span>
            <span class="n">fmin</span><span class="o">=</span><span class="n">fmin</span><span class="p">,</span>
            <span class="n">fmax</span><span class="o">=</span><span class="n">fmax</span><span class="p">,</span>
            <span class="n">faverage</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">mt_adaptive</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">n_jobs</span><span class="o">=</span><span class="mi">1</span>
        <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">power_spectral_destiny_computation</span><span class="p">(</span><span class="nb">input</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="n">epochs</span><span class="p">,</span> <span class="n">inv</span><span class="p">,</span> <span class="n">lambda2</span><span class="p">,</span> <span class="n">fmin</span><span class="p">,</span> <span class="n">fmax</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">bandwidth</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="nb">input</span>

        <span class="k">def</span> <span class="nf">compute_psd_avg</span><span class="p">(</span>
                <span class="n">epochs</span><span class="p">:</span> <span class="n">mne</span><span class="o">.</span><span class="n">Epochs</span><span class="p">,</span>
                <span class="n">inv</span><span class="p">:</span> <span class="n">mne</span><span class="o">.</span><span class="n">minimum_norm</span><span class="o">.</span><span class="n">InverseOperator</span><span class="p">,</span>
                <span class="n">lambda2</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
                <span class="n">method</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
                <span class="n">fmin</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                <span class="n">fmax</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                <span class="n">bandwidth</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span>
                <span class="n">label</span><span class="p">:</span> <span class="n">mne</span><span class="o">.</span><span class="n">Label</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
            <span class="n">psd_stc</span> <span class="o">=</span> <span class="n">mne</span><span class="o">.</span><span class="n">minimum_norm</span><span class="o">.</span><span class="n">compute_source_psd_epochs</span><span class="p">(</span><span class="n">epochs</span><span class="p">,</span> <span class="n">inv</span><span class="p">,</span>
                                                                 <span class="n">lambda2</span><span class="o">=</span><span class="n">lambda2</span><span class="p">,</span>
                                                                 <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span> <span class="n">fmin</span><span class="o">=</span><span class="n">fmin</span><span class="p">,</span> <span class="n">fmax</span><span class="o">=</span><span class="n">fmax</span><span class="p">,</span>
                                                                 <span class="n">bandwidth</span><span class="o">=</span><span class="n">bandwidth</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>
            <span class="n">psd_avg</span> <span class="o">=</span> <span class="mf">0.</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">stc</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">psd_stc</span><span class="p">):</span>
                <span class="n">psd_avg</span> <span class="o">+=</span> <span class="n">stc</span><span class="o">.</span><span class="n">data</span>
            <span class="n">psd_avg</span> <span class="o">/=</span> <span class="nb">len</span><span class="p">(</span><span class="n">epochs</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">psd_avg</span>

        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
            <span class="n">compute_psd_avg</span><span class="p">(</span><span class="n">epochs</span><span class="p">,</span> <span class="n">inv</span><span class="p">,</span> <span class="n">lambda2</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">fmin</span><span class="p">,</span> <span class="n">fmax</span><span class="p">,</span> <span class="n">bandwidth</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">labels</span>
        <span class="p">])</span>

    <span class="k">def</span> <span class="nf">correlationenvelope_connectivity_computation</span><span class="p">(</span><span class="nb">input</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="n">label_ts</span><span class="p">,</span> <span class="n">sfreq</span><span class="p">,</span> <span class="n">fmin</span><span class="p">,</span> <span class="n">fmax</span><span class="p">,</span> <span class="n">method</span> <span class="o">=</span> <span class="nb">input</span>

        <span class="c1"># filtering</span>
        <span class="n">dt</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">sfreq</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">fftfreq</span><span class="p">(</span><span class="n">label_ts</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">d</span><span class="o">=</span><span class="n">dt</span><span class="p">)</span>
        <span class="n">filtered_label_ts</span> <span class="o">=</span> <span class="n">label_ts</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">label_ts</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">filtered_label_ts</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span>
            <span class="n">f_signal</span> <span class="o">=</span> <span class="n">rfft</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            <span class="n">cut_f_signal</span> <span class="o">=</span> <span class="n">f_signal</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">cut_f_signal</span><span class="p">[(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">w</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">fmin</span><span class="p">)],</span> <span class="n">cut_f_signal</span><span class="p">[(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">w</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">fmax</span><span class="p">)]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">cs</span> <span class="o">=</span> <span class="n">irfft</span><span class="p">(</span><span class="n">cut_f_signal</span><span class="p">)</span>
            <span class="n">filtered_label_ts</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">cs</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;pearson&#39;</span><span class="p">:</span> <span class="n">pearson_ts</span><span class="p">,</span>
            <span class="s1">&#39;envelope&#39;</span><span class="p">:</span> <span class="n">mne</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">envelope_correlation</span>
        <span class="p">}[</span><span class="n">method</span><span class="p">](</span><span class="n">filtered_label_ts</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">switch_params</span><span class="p">(</span>
            <span class="n">epochs</span><span class="p">:</span> <span class="n">mne</span><span class="o">.</span><span class="n">Epochs</span><span class="p">,</span>
            <span class="n">inv</span><span class="p">:</span> <span class="n">mne</span><span class="o">.</span><span class="n">minimum_norm</span><span class="o">.</span><span class="n">InverseOperator</span><span class="p">,</span>
            <span class="n">lambda2</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
            <span class="n">bandwidth</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span>
            <span class="n">labels</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">mne</span><span class="o">.</span><span class="n">Label</span><span class="p">],</span>
            <span class="n">label_ts</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span>
            <span class="n">sfreq</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
            <span class="n">fmin</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
            <span class="n">fmax</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
            <span class="n">method</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
            <span class="n">se_method</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>

        <span class="n">connectivity_params</span> <span class="o">=</span> <span class="p">(</span><span class="n">label_ts</span><span class="p">,</span> <span class="n">sfreq</span><span class="p">,</span> <span class="n">fmin</span><span class="p">,</span> <span class="n">fmax</span><span class="p">,</span> <span class="n">method</span><span class="p">)</span>
        <span class="n">psd_params</span> <span class="o">=</span> <span class="p">(</span><span class="n">epochs</span><span class="p">,</span> <span class="n">inv</span><span class="p">,</span> <span class="n">lambda2</span><span class="p">,</span> <span class="n">fmin</span><span class="p">,</span> <span class="n">fmax</span><span class="p">,</span> <span class="n">se_method</span><span class="p">,</span> <span class="n">bandwidth</span><span class="p">,</span> <span class="n">labels</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;psd&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">psd_params</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">connectivity_params</span>

    <span class="n">out</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nb">str</span><span class="p">(</span><span class="n">fmin</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">fmax</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;Hz&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="n">method</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;psd&#39;</span><span class="p">:</span> <span class="n">power_spectral_destiny_computation</span><span class="p">,</span>
                <span class="s1">&#39;coh&#39;</span><span class="p">:</span> <span class="n">spectral_connectivity_computation</span><span class="p">,</span>
                <span class="s1">&#39;cohy&#39;</span><span class="p">:</span> <span class="n">spectral_connectivity_computation</span><span class="p">,</span>
                <span class="s1">&#39;imcoh&#39;</span><span class="p">:</span> <span class="n">spectral_connectivity_computation</span><span class="p">,</span>
                <span class="s1">&#39;plv&#39;</span><span class="p">:</span> <span class="n">spectral_connectivity_computation</span><span class="p">,</span>
                <span class="s1">&#39;ciplv&#39;</span><span class="p">:</span> <span class="n">spectral_connectivity_computation</span><span class="p">,</span>
                <span class="s1">&#39;ppc&#39;</span><span class="p">:</span> <span class="n">spectral_connectivity_computation</span><span class="p">,</span>
                <span class="s1">&#39;pli&#39;</span><span class="p">:</span> <span class="n">spectral_connectivity_computation</span><span class="p">,</span>
                <span class="s1">&#39;pli2_unbiased&#39;</span><span class="p">:</span> <span class="n">spectral_connectivity_computation</span><span class="p">,</span>
                <span class="s1">&#39;wpli&#39;</span><span class="p">:</span> <span class="n">spectral_connectivity_computation</span><span class="p">,</span>
                <span class="s1">&#39;wpli2_debiased&#39;</span><span class="p">:</span> <span class="n">spectral_connectivity_computation</span><span class="p">,</span>
                <span class="s1">&#39;envelope&#39;</span><span class="p">:</span> <span class="n">correlationenvelope_connectivity_computation</span><span class="p">,</span>
                <span class="s1">&#39;pearson&#39;</span><span class="p">:</span> <span class="n">correlationenvelope_connectivity_computation</span>
            <span class="p">}[</span><span class="n">method</span><span class="p">](</span>
                <span class="n">switch_params</span><span class="p">(</span>
                    <span class="n">epochs</span><span class="p">,</span>
                    <span class="n">inv</span><span class="p">,</span>
                    <span class="n">lambda2</span><span class="p">,</span>
                    <span class="n">bandwidth</span><span class="p">,</span>
                    <span class="n">labels</span><span class="p">,</span>
                    <span class="n">label_ts</span><span class="p">,</span>
                    <span class="n">sfreq</span><span class="p">,</span>
                    <span class="n">fmin</span><span class="p">,</span>
                    <span class="n">fmax</span><span class="p">,</span>
                    <span class="n">method</span><span class="p">,</span>
                    <span class="n">se_method</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">method</span> <span class="ow">in</span> <span class="n">methods</span>
        <span class="p">}</span> <span class="k">for</span> <span class="n">fmin</span><span class="p">,</span> <span class="n">fmax</span> <span class="ow">in</span> <span class="n">freq_bands</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">out</span></div>


<div class="viewcode-block" id="nodes_creation"><a class="viewcode-back" href="../../../nodestimation.processing.html#nodestimation.processing.mneraw.nodes_creation">[docs]</a><span class="nd">@read_or_write</span><span class="p">(</span><span class="s1">&#39;nodes&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">nodes_creation</span><span class="p">(</span>
        <span class="n">labels</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">mne</span><span class="o">.</span><span class="n">Label</span><span class="p">],</span>
        <span class="n">features</span><span class="p">:</span> <span class="n">LabelsFeatures</span><span class="p">,</span>
        <span class="n">nodes_coordinates</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="n">resec_coordinates</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span>
        <span class="n">resec_txt</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">_subject_tree</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">SubjectTree</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">_conditions</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">_priority</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Node</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;computes `features &lt;nodestimation.html#list-of-metrics&gt;`_, uses :func:`nodestimation.project.read_or_write` decorator</span>

<span class="sd">            :param labels: brain regions representation</span>
<span class="sd">            :type labels: |ilist|_ *of* |imne.Label|_</span>
<span class="sd">            :param features: `centrality metrics &lt;nodestimation.html#centrality-metrics&gt;`_ values for each `feature &lt;nodestimation.html#list-of-metrics&gt;`_ relatively to labels_</span>
<span class="sd">            :type features: *look for LabelsFeatures in* :mod:`nodestimation.project.annotations`</span>
<span class="sd">            :param nodes_coordinates: center coordinates in mni_ for each node</span>
<span class="sd">            :type nodes_coordinates: |inp.ndarray|_</span>
<span class="sd">            :param resec_coordinates: resection area coordinates in mni_ for each node</span>
<span class="sd">            :type resec_coordinates: |inp.ndarray|_</span>
<span class="sd">            :param resec_txt: resection area text description</span>
<span class="sd">            :type resec_txt: str</span>
<span class="sd">            :param _subject_tree: representation of patient`s files structure, default None</span>
<span class="sd">            :type _subject_tree: *look for SubjectTree in* :mod:`nodestimation.project.annotations` *, optional*</span>
<span class="sd">            :param _conditions: output from :func:`nodestimation.project.conditions_unique_code`, defaults to True</span>
<span class="sd">            :type _conditions: str, optional</span>
<span class="sd">            :param _priority: if several files are read, which one to choose, if None, read all of them, default None</span>
<span class="sd">            :type _priority: int, optional</span>
<span class="sd">            :return: computed nodes</span>
<span class="sd">            :rtype: list_ of :class:`nodestimation.Node`</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">is_resected</span><span class="p">(</span><span class="n">resec_coordinates</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span> <span class="n">node_coordinates</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">radius</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">resec_coordinates</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">resec_coordinate</span> <span class="ow">in</span> <span class="n">resec_coordinates</span><span class="p">:</span>
                <span class="n">diff</span> <span class="o">=</span> <span class="n">node_coordinates</span> <span class="o">-</span> <span class="n">resec_coordinate</span>
                <span class="n">dist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">diff</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">diff</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">diff</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">dist</span> <span class="o">&lt;=</span> <span class="n">radius</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">add_resected</span><span class="p">(</span><span class="n">resec_txt</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">nodes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Node</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">resec_txt</span><span class="p">:</span>
                <span class="n">node</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="s1">&#39;resected&#39;</span>

    <span class="n">nodes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">labels</span><span class="p">:</span>
        <span class="n">nodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">Node</span><span class="p">(</span>
                <span class="n">label</span><span class="p">,</span>
                <span class="p">{</span>
                    <span class="n">freq_band</span><span class="p">:</span> <span class="p">{</span>
                        <span class="n">method</span><span class="p">:</span> <span class="p">{</span>
                            <span class="n">centrality</span><span class="p">:</span>
                            <span class="n">features</span><span class="p">[</span><span class="n">freq_band</span><span class="p">][</span><span class="n">method</span><span class="p">][</span><span class="n">centrality</span><span class="p">][</span><span class="n">label</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
                            <span class="k">for</span> <span class="n">centrality</span> <span class="ow">in</span> <span class="n">features</span><span class="p">[</span><span class="n">freq_band</span><span class="p">][</span><span class="n">method</span><span class="p">]</span>
                        <span class="p">}</span> <span class="k">for</span> <span class="n">method</span> <span class="ow">in</span> <span class="n">features</span><span class="p">[</span><span class="n">freq_band</span><span class="p">]</span>
                    <span class="p">}</span> <span class="k">for</span> <span class="n">freq_band</span> <span class="ow">in</span> <span class="n">features</span>
                <span class="p">},</span>
                <span class="n">nodes_coordinates</span><span class="p">[</span><span class="n">label</span><span class="o">.</span><span class="n">name</span><span class="p">],</span>
                <span class="s1">&#39;resected&#39;</span> <span class="k">if</span> <span class="n">is_resected</span><span class="p">(</span><span class="n">resec_coordinates</span><span class="p">,</span> <span class="n">nodes_coordinates</span><span class="p">[</span><span class="n">label</span><span class="o">.</span><span class="n">name</span><span class="p">])</span> <span class="k">else</span> <span class="s1">&#39;spared&#39;</span>
            <span class="p">)</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">resec_txt</span><span class="p">:</span>
        <span class="n">add_resected</span><span class="p">(</span><span class="n">resec_txt</span><span class="p">,</span> <span class="n">nodes</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">all</span><span class="p">([</span><span class="s1">&#39;spared&#39;</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">type</span> <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">]):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">11</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Resected nodes not found, increase node radius from </span><span class="si">{}</span><span class="s1"> to </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">:</span>
                <span class="n">node</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="s1">&#39;resected&#39;</span> <span class="k">if</span> <span class="n">is_resected</span><span class="p">(</span><span class="n">resec_coordinates</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">center_coordinates</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="k">else</span> <span class="s1">&#39;spared&#39;</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">([</span><span class="s1">&#39;spared&#39;</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">type</span> <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">]):</span>
                <span class="k">break</span>

    <span class="k">if</span> <span class="nb">all</span><span class="p">([</span><span class="s1">&#39;spared&#39;</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">type</span> <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">]):</span>
        <span class="k">raise</span> <span class="ne">Warning</span><span class="p">(</span><span class="s1">&#39;Resected nodes not found&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">nodes</span></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../index.html">NodesEstimation</a></h1>








<h3>Navigation</h3>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../nodestimation.html">nodestimation package</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../index.html">Documentation overview</a><ul>
  <li><a href="../../index.html">Module code</a><ul>
  <li><a href="../../nodestimation.html">nodestimation</a><ul>
  <li><a href="../processing.html">nodestimation.processing</a><ul>
  </ul></li>
  </ul></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2021, Alexey Zabolotniy.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.8.5</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.8</a>
      
    </div>

    

    
  </body>
</html>